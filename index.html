<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/animate.css">
    <title>Simon keyboard</title>
  </head>
  <body>
    <div class="keyboard-container animated fadeInDown">
      <div class="keyboard-line">
        <div class="key" data-key="81">Q</div>
        <div class="key" data-key="87">W</div>
        <div class="key" data-key="69">E</div>
        <div class="key" data-key="82">R</div>
        <div class="key" data-key="84">T</div>
        <div class="key" data-key="89">Y</div>
        <div class="key" data-key="85">U</div>
        <div class="key" data-key="73">I</div>
        <div class="key" data-key="79">O</div>
        <div class="key" data-key="80">P</div>
      </div>
      <div class="keyboard-line" id="second-line">
        <div class="key" data-key="65">A</div>
        <div class="key" data-key="83">S</div>
        <div class="key" data-key="68">D</div>
        <div class="key" data-key="70">F</div>
        <div class="key" data-key="71">G</div>
        <div class="key" data-key="72">H</div>
        <div class="key" data-key="74">J</div>
        <div class="key" data-key="75">K</div>
        <div class="key" data-key="76">L</div>
      </div>
      <div class="keyboard-line" id="third-line">
        <div class="key" data-key="90">Z</div>
        <div class="key" data-key="88">X</div>
        <div class="key" data-key="67">C</div>
        <div class="key" data-key="86">V</div>
        <div class="key" data-key="66">B</div>
        <div class="key" data-key="78">N</div>
        <div class="key" data-key="77">M</div>
      </div>
    </div>
    <script type="text/javascript">
    const niveles =20;
    let teclas = getRanomKeys(niveles);
    function nextLevel(currentLevel){
      (currentLevel == niveles) ?  alert('ganaste') : ''
      for (let i = 0; i <= currentLevel; i++) {
        setTimeout(()=>{activate(teclas[i])}, (1000)*(i+1))
      }
      let i =0;
      let currentKey= teclas[i];
      window.addEventListener('keydown', keyPressed)

      function keyPressed(ev){
        console.log(ev.keyCode);
        if(ev.keyCode == currentKey){
          activate(currentKey, {success:true});
          i++
          if (i>currentLevel) {
            window.removeEventListener('keydown', keyPressed )
            setTimeout(()=>nextLevel(i), 1000)
          }
          currentKey = teclas[i]
        }else{
          activate(ev.keyCode, {fail:true})
          window.removeEventListener('keydown', keyPressed )
          alert(`Perdiste nivel : ${currentLevel}/ ${niveles}`)
          nextLevel(0)
        }
      }
    }
    nextLevel(0)
    function keyPressed(){
      window.addEventListener('keydown', (ev)=>{

      })
    }
    function getRandomKey(){
      const min = 65;
      const max =90;
      return Math.round(Math.random() *(max-min)  + min)
    }
    function getRanomKeys(niveles){
      return new Array(niveles).fill(0).map(getRandomKey);
    }
    function  getElementByKeyCode(dataKey){
      return document.querySelector(`[data-key="${dataKey}"]`)
    }
    function activate(keyCode, options={}){
      const el = getElementByKeyCode(keyCode);
      el.classList.add('active');
      if(options.success){
        el.classList.add('success');
      }else if(options.fail){
        el.classList.add('fail');
      }
      deactivate(el)
    }
    function deactivate(el){
      setTimeout(()=>{
        el.className = "key";
      }, 1000)
    }
    </script>
  </body>
</html>
